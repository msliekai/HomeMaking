<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hm.mapper.UserMapper">

    <!--    普通用户注册--><!--   并返回id -->
    <insert id="cUserReg" parameterType="com.hm.entity.TblUser" useGeneratedKeys="true" keyProperty="id">
        insert into tbluser
        (username,userpwd,usersex,userphone,usertime,usermoney,usercon,stid,userurl,usercard,rid)
        values
        (#{username},#{userpwd},#{usersex},#{userphone},#{usertime},0,0,1,#{userurl},#{usercard},2)
    </insert>
    <!--    普通用户登录-->
    <select id="cUserLogin" parameterType="com.hm.entity.TblUser" resultType="com.hm.entity.TblUser">
         select * from tbluser where rid=2 and stid=1 and userphone=#{userphone} and userpwd=#{userpwd}
    </select>
<!--    查看普通用户是否被禁用-->
    <select id="queryUserState" parameterType="java.lang.String" resultType="java.lang.Integer">
        select stid from tbluser  where userphone=#{userphone}
    </select>
    <!--    增加地址-->
    <insert id="addSite" parameterType="com.hm.entity.TblSite">
        insert into tblsite
        (userid,scontext,sa,sb,sc)
        values
        (#{userid},#{scontext},#{sa},#{sb},#{sc})
    </insert>

    <!--查询用户余额-->
    <select id="jUserMoney" resultType="com.hm.entity.UserMoney">
       SELECT o.oid,o.onumber,c.cosname,ct.ctname,o.otime,f.fname,z.hzbei*sf.sfcos as money from tblorder o ,tbluser u ,tblCOS c ,tblCOStype ct ,tblstaff sf,tblfirm f ,tblHZ  z
WHERE o.userid = u.userid and o.sfid = sf.sfid and sf.fid = f.fid and o.hzid = z.hzid and o.cosid = c.cosid and c.ctid = ct.ctid
        <if test="userid!=null">
            and u.userid = #{userid}
        </if>
        <if test="0 &lt; page">
            <bind name="page" value="(page-1)* limit"/>
            limit #{page} ,#{limit}
        </if>
    </select>
    <!--查询用户消费-->
    <!--<select id="jUserBalance" resultType="com.hm.entity.UserMoney">
        SELECT o.oid,o.onumber,c.cosname,ct.ctname,o.otime,f.fname,z.hzbei*sf.sfcos as money from tblorder o ,tbluser u ,tblCOS c ,tblCOStype ct ,tblstaff sf,tblfirm f ,tblHZ  z
        WHERE o.userid = u.userid and o.sfid = sf.sfid and sf.fid = f.fid and o.hzid = z.hzid and o.cosid = c.cosid and c.ctid = ct.ctid  and u.userid = #{userid}
        <if test="0 &lt; page">
            <bind name="page" value="(page-1)* limit"/>
            limit #{page} ,#{limit}
        </if>
    </select>-->
</mapper>